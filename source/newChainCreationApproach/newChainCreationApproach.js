"use strict";Object.defineProperty(exports, "__esModule", { value: true });exports.MultiplePrototypeChain = void 0;

let self = class MultiplePrototypeChain {
  static newChainOnInstanceCreation({
    Class,
    contextInstance })
  {
    return new Proxy(Class, {
      construct: (target, argumentsList, newConstructorFunc) => {
        let instance = Reflect.construct(target, argumentsList);
        instance = self.createUniqueProtoChain({ object: instance });
        instance = self.insertObjectToPrototypeChain({
          prototypeChain: instance,
          objectToAdd: contextInstance,
          beforePrototype: contextInstance.__proto__.__proto__ });

        return instance;
      } });

  }

  static createUniqueProtoChain({ object = null }) {
    if (object == null || object.constructor == Object || object.constructor == Function) return object;

    let delegatedPrototype = Object.getPrototypeOf(object);
    let nextPointerPrototype = self.createUniqueProtoChain({ object: delegatedPrototype });
    let pointerPrototype = Object.create(nextPointerPrototype);
    if (!pointerPrototype.hasOwnProperty('delegatedPrototype')) {
      Object.defineProperty(pointerPrototype, 'delegatedPrototype', { value: object, writable: true, enumerable: true, configurable: true });
    }
    let proxyHandler = self.handlerMultiplePrototypeChainPattern({ delegatedPrototype: object });
    pointerPrototype = new Proxy(pointerPrototype, proxyHandler);
    return pointerPrototype;
  }

  static handlerMultiplePrototypeChainPattern({ delegatedPrototype }) {
    return {
      get: function (target, property, receiver) {
        switch (property) {
          case 'delegatedPrototype':
            return Reflect.get(target, property);
            break;
          case '__proto__':
            return Object.getPrototypeOf(receiver);
            break;
          default:
            break;}

        if (delegatedPrototype.hasOwnProperty(property)) {
          return Reflect.get(delegatedPrototype, property);
        } else if (Object.getPrototypeOf(target)) {
          return Reflect.get(Object.getPrototypeOf(target), property);
        } else {
          return undefined;
        }
      },
      set: function (target, property, value, receiver) {
        switch (property) {
          case '__proto__':
            return Object.setPrototypeOf(target, value);
            break;
          default:
            return Reflect.set(delegatedPrototype, property, value);
            break;}

      },
      has: function (target, prop) {
        return prop in delegatedPrototype;
      } };

  }


  static insertObjectToPrototypeChain({
    prototypeChain,
    objectToAdd,
    beforePrototype })
  {

    let previousPrototype = prototypeChain;
    let nextPrototype = prototypeChain.__proto__;
    while (nextPrototype && beforePrototype !== nextPrototype.delegatedPrototype) {
      previousPrototype = nextPrototype;
      nextPrototype = nextPrototype.__proto__;
    }
    if (!nextPrototype) throw new Error('â€¢ Couldn`t add object to prototype chain. No matching "beforePrototype" was found.');

    let pointerPrototype = Object.create(nextPrototype);
    if (!pointerPrototype.hasOwnProperty('delegatedPrototype')) {
      Object.defineProperty(pointerPrototype, 'delegatedPrototype', { value: objectToAdd, writable: true, enumerable: true, configurable: true });
    }
    pointerPrototype = new Proxy(
    pointerPrototype,
    self.handlerMultiplePrototypeChainPattern({
      delegatedPrototype: objectToAdd }));


    Object.setPrototypeOf(previousPrototype, pointerPrototype);
    console.log(prototypeChain);
    return prototypeChain;
  }};exports.MultiplePrototypeChain = self;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NvdXJjZS9uZXdDaGFpbkNyZWF0aW9uQXBwcm9hY2gvbmV3Q2hhaW5DcmVhdGlvbkFwcHJvYWNoLmpzIl0sIm5hbWVzIjpbInNlbGYiLCJNdWx0aXBsZVByb3RvdHlwZUNoYWluIiwibmV3Q2hhaW5Pbkluc3RhbmNlQ3JlYXRpb24iLCJDbGFzcyIsImNvbnRleHRJbnN0YW5jZSIsIlByb3h5IiwiY29uc3RydWN0IiwidGFyZ2V0IiwiYXJndW1lbnRzTGlzdCIsIm5ld0NvbnN0cnVjdG9yRnVuYyIsImluc3RhbmNlIiwiUmVmbGVjdCIsImNyZWF0ZVVuaXF1ZVByb3RvQ2hhaW4iLCJvYmplY3QiLCJpbnNlcnRPYmplY3RUb1Byb3RvdHlwZUNoYWluIiwicHJvdG90eXBlQ2hhaW4iLCJvYmplY3RUb0FkZCIsImJlZm9yZVByb3RvdHlwZSIsIl9fcHJvdG9fXyIsImNvbnN0cnVjdG9yIiwiT2JqZWN0IiwiRnVuY3Rpb24iLCJkZWxlZ2F0ZWRQcm90b3R5cGUiLCJnZXRQcm90b3R5cGVPZiIsIm5leHRQb2ludGVyUHJvdG90eXBlIiwicG9pbnRlclByb3RvdHlwZSIsImNyZWF0ZSIsImhhc093blByb3BlcnR5IiwiZGVmaW5lUHJvcGVydHkiLCJ2YWx1ZSIsIndyaXRhYmxlIiwiZW51bWVyYWJsZSIsImNvbmZpZ3VyYWJsZSIsInByb3h5SGFuZGxlciIsImhhbmRsZXJNdWx0aXBsZVByb3RvdHlwZUNoYWluUGF0dGVybiIsImdldCIsInByb3BlcnR5IiwicmVjZWl2ZXIiLCJ1bmRlZmluZWQiLCJzZXQiLCJzZXRQcm90b3R5cGVPZiIsImhhcyIsInByb3AiLCJwcmV2aW91c1Byb3RvdHlwZSIsIm5leHRQcm90b3R5cGUiLCJFcnJvciIsImNvbnNvbGUiLCJsb2ciXSwibWFwcGluZ3MiOiI7O0FBRUEsSUFBSUEsSUFBSSxHQUFHLE1BQU1DLHNCQUFOLENBQTZCO0FBQ3RDLFNBQU9DLDBCQUFQLENBQWtDO0FBQ2hDQyxJQUFBQSxLQURnQztBQUVo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QixhQUFkLENBQXZCO0FBQ0EsUUFBSSxDQUFDbkIsZ0JBQWdCLENBQUNFLGNBQWpCLENBQWdDLG9CQUFoQyxDQUFMLEVBQTREO0FBQzFEUCxNQUFBQSxNQUFNLENBQUNRLGNBQVAsQ0FBc0JILGdCQUF0QixFQUF3QyxvQkFBeEMsRUFBOEQsRUFBRUksS0FBSyxFQUFFYixXQUFULEVBQXNCYyxRQUFRLEVBQUUsSUFBaEMsRUFBc0NDLFVBQVUsRUFBRSxJQUFsRCxFQUF3REMsWUFBWSxFQUFFLElBQXRFLEVBQTlEO0FBQ0Q7QUFDRFAsSUFBQUEsZ0JBQWdCLEdBQUcsSUFBSXBCLEtBQUo7QUFDakJvQixJQUFBQSxnQkFEaUI7QUFFakJ6QixJQUFBQSxJQUFJLENBQUNrQyxvQ0FBTCxDQUEwQztBQUN4Q1osTUFBQUEsa0JBQWtCLEVBQUVOLFdBRG9CLEVBQTFDLENBRmlCLENBQW5COzs7QUFNQUksSUFBQUEsTUFBTSxDQUFDb0IsY0FBUCxDQUFzQkcsaUJBQXRCLEVBQXlDbEIsZ0JBQXpDO0FBQ0FxQixJQUFBQSxPQUFPLENBQUNDLEdBQVIsQ0FBWWhDLGNBQVo7QUFDQSxXQUFPQSxjQUFQO0FBQ0QsR0FsR3FDLENBQXhDLEMiLCJzb3VyY2VzQ29udGVudCI6WyIvLyEgRGVwcmVjYXRlZDogVGhpcyBpcyBhbiBvbGQgcXVpY2sgc3BlY2lmaWMgaW1wbGVtZW50YXRpb24uXHJcblxyXG5sZXQgc2VsZiA9IGNsYXNzIE11bHRpcGxlUHJvdG90eXBlQ2hhaW4ge1xyXG4gIHN0YXRpYyBuZXdDaGFpbk9uSW5zdGFuY2VDcmVhdGlvbih7XHJcbiAgICBDbGFzcywgLy8gd3JhcCBjb25zdHJ1Y3RvciBvZiBDbGFzcyBhbmQgY3JlYXRlIGEgbmV3IGNoYWluIGZvciBlYWNoIG5ldyBpbnN0YW5jZS5cclxuICAgIGNvbnRleHRJbnN0YW5jZSwgLy8gVGhlIGluc3RuYWNlIHRvIGJlIGFkZGVkIHRvIHRoZSBjaGFpbi5cclxuICB9KSB7XHJcbiAgICByZXR1cm4gbmV3IFByb3h5KENsYXNzLCB7XHJcbiAgICAgIGNvbnN0cnVjdDogKHRhcmdldCwgYXJndW1lbnRzTGlzdCwgbmV3Q29uc3RydWN0b3JGdW5jKSA9PiB7XHJcbiAgICAgICAgbGV0IGluc3RhbmNlID0gUmVmbGVjdC5jb25zdHJ1Y3QodGFyZ2V0LCBhcmd1bWVudHNMaXN0KVxyXG4gICAgICAgIGluc3RhbmNlID0gc2VsZi5jcmVhdGVVbmlxdWVQcm90b0NoYWluKHsgb2JqZWN0OiBpbnN0YW5jZSB9KVxyXG4gICAgICAgIGluc3RhbmNlID0gc2VsZi5pbnNlcnRPYmplY3RUb1Byb3RvdHlwZUNoYWluKHtcclxuICAgICAgICAgIHByb3RvdHlwZUNoYWluOiBpbnN0YW5jZSxcclxuICAgICAgICAgIG9iamVjdFRvQWRkOiBjb250ZXh0SW5zdGFuY2UsXHJcbiAgICAgICAgICBiZWZvcmVQcm90b3R5cGU6IGNvbnRleHRJbnN0YW5jZS5fX3Byb3RvX18uX19wcm90b19fLFxyXG4gICAgICAgIH0pXHJcbiAgICAgICAgcmV0dXJuIGluc3RhbmNlXHJcbiAgICAgIH0sXHJcbiAgICB9KVxyXG4gIH1cclxuXHJcbiAgc3RhdGljIGNyZWF0ZVVuaXF1ZVByb3RvQ2hhaW4oeyBvYmplY3QgPSBudWxsIH0pIHtcclxuICAgIGlmIChvYmplY3QgPT0gbnVsbCB8fCBvYmplY3QuY29uc3RydWN0b3IgPT0gT2JqZWN0IHx8IG9iamVjdC5jb25zdHJ1Y3RvciA9PSBGdW5jdGlvbikgcmV0dXJuIG9iamVjdFxyXG5cclxuICAgIGxldCBkZWxlZ2F0ZWRQcm90b3R5cGUgPSBPYmplY3QuZ2V0UHJvdG90eXBlT2Yob2JqZWN0KVxyXG4gICAgbGV0IG5leHRQb2ludGVyUHJvdG90eXBlID0gc2VsZi5jcmVhdGVVbmlxdWVQcm90b0NoYWluKHsgb2JqZWN0OiBkZWxlZ2F0ZWRQcm90b3R5cGUgfSlcclxuICAgIGxldCBwb2ludGVyUHJvdG90eXBlID0gT2JqZWN0LmNyZWF0ZShuZXh0UG9pbnRlclByb3RvdHlwZSlcclxuICAgIGlmICghcG9pbnRlclByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eSgnZGVsZWdhdGVkUHJvdG90eXBlJykpIHtcclxuICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KHBvaW50ZXJQcm90b3R5cGUsICdkZWxlZ2F0ZWRQcm90b3R5cGUnLCB7IHZhbHVlOiBvYmplY3QsIHdyaXRhYmxlOiB0cnVlLCBlbnVtZXJhYmxlOiB0cnVlLCBjb25maWd1cmFibGU6IHRydWUgfSlcclxuICAgIH1cclxuICAgIGxldCBwcm94eUhhbmRsZXIgPSBzZWxmLmhhbmRsZXJNdWx0aXBsZVByb3RvdHlwZUNoYWluUGF0dGVybih7IGRlbGVnYXRlZFByb3RvdHlwZTogb2JqZWN0IH0pXHJcbiAgICBwb2ludGVyUHJvdG90eXBlID0gbmV3IFByb3h5KHBvaW50ZXJQcm90b3R5cGUsIHByb3h5SGFuZGxlcilcclxuICAgIHJldHVybiBwb2ludGVyUHJvdG90eXBlXHJcbiAgfVxyXG5cclxuICBzdGF0aWMgaGFuZGxlck11bHRpcGxlUHJvdG90eXBlQ2hhaW5QYXR0ZXJuKHsgZGVsZWdhdGVkUHJvdG90eXBlIH0pIHtcclxuICAgIHJldHVybiB7XHJcbiAgICAgIGdldDogZnVuY3Rpb24odGFyZ2V0LCBwcm9wZXJ0eSwgcmVjZWl2ZXIpIHtcclxuICAgICAgICBzd2l0Y2ggKHByb3BlcnR5KSB7XHJcbiAgICAgICAgICBjYXNlICdkZWxlZ2F0ZWRQcm90b3R5cGUnOlxyXG4gICAgICAgICAgICByZXR1cm4gUmVmbGVjdC5nZXQodGFyZ2V0LCBwcm9wZXJ0eSlcclxuICAgICAgICAgICAgYnJlYWtcclxuICAgICAgICAgIGNhc2UgJ19fcHJvdG9fXyc6XHJcbiAgICAgICAgICAgIHJldHVybiBPYmplY3QuZ2V0UHJvdG90eXBlT2YocmVjZWl2ZXIpXHJcbiAgICAgICAgICAgIGJyZWFrXHJcbiAgICAgICAgICBkZWZhdWx0OlxyXG4gICAgICAgICAgICBicmVha1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAoZGVsZWdhdGVkUHJvdG90eXBlLmhhc093blByb3BlcnR5KHByb3BlcnR5KSkge1xyXG4gICAgICAgICAgcmV0dXJuIFJlZmxlY3QuZ2V0KGRlbGVnYXRlZFByb3RvdHlwZSwgcHJvcGVydHkpXHJcbiAgICAgICAgfSBlbHNlIGlmIChPYmplY3QuZ2V0UHJvdG90eXBlT2YodGFyZ2V0KSkge1xyXG4gICAgICAgICAgcmV0dXJuIFJlZmxlY3QuZ2V0KE9iamVjdC5nZXRQcm90b3R5cGVPZih0YXJnZXQpLCBwcm9wZXJ0eSlcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgcmV0dXJuIHVuZGVmaW5lZFxyXG4gICAgICAgIH1cclxuICAgICAgfSxcclxuICAgICAgc2V0OiBmdW5jdGlvbih0YXJnZXQsIHByb3BlcnR5LCB2YWx1ZSwgcmVjZWl2ZXIpIHtcclxuICAgICAgICBzd2l0Y2ggKHByb3BlcnR5KSB7XHJcbiAgICAgICAgICBjYXNlICdfX3Byb3RvX18nOlxyXG4gICAgICAgICAgICByZXR1cm4gT2JqZWN0LnNldFByb3RvdHlwZU9mKHRhcmdldCwgdmFsdWUpXHJcbiAgICAgICAgICAgIGJyZWFrXHJcbiAgICAgICAgICBkZWZhdWx0OlxyXG4gICAgICAgICAgICByZXR1cm4gUmVmbGVjdC5zZXQoZGVsZWdhdGVkUHJvdG90eXBlLCBwcm9wZXJ0eSwgdmFsdWUpXHJcbiAgICAgICAgICAgIGJyZWFrXHJcbiAgICAgICAgfVxyXG4gICAgICB9LFxyXG4gICAgICBoYXM6IGZ1bmN0aW9uKHRhcmdldCwgcHJvcCkge1xyXG4gICAgICAgIHJldHVybiBwcm9wIGluIGRlbGVnYXRlZFByb3RvdHlwZVxyXG4gICAgICB9LFxyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgLy8gQWRkIGFuIGluc3RhbmNlIHByb3RvdHlwZSB0byBhIHByb3RvdHlwZSBjaGFpbiBqdXN0IGJlZm9yZSB0aGUgaW5zdGFuY2UncyBjb25zdHJ1Y3RvciBwcm90b3R5cGUuXHJcbiAgc3RhdGljIGluc2VydE9iamVjdFRvUHJvdG90eXBlQ2hhaW4oe1xyXG4gICAgcHJvdG90eXBlQ2hhaW4sIC8vIGNoYWluIHRvIGFkZCB0b1xyXG4gICAgb2JqZWN0VG9BZGQsIC8vIG9iamVjdCB0byBhZGQgYXMgcHJvdG90eXBlXHJcbiAgICBiZWZvcmVQcm90b3R5cGUsIC8vIGxvY2F0aW9uIG9mIGluc2VydGlvblxyXG4gIH0pIHtcclxuICAgIC8vIGZpbmQgcG9zaXRpb24gb2YgYmVmb3JlUHJvdG90eXBlIHdpdGggcmVmZXJlbmNlcyB0byBuZXh0IGFuZCBwcmV2aW91cyBwcm90b3R5cGVcclxuICAgIGxldCBwcmV2aW91c1Byb3RvdHlwZSA9IHByb3RvdHlwZUNoYWluIC8vIHN0YXJ0aW5nIHBvaW50XHJcbiAgICBsZXQgbmV4dFByb3RvdHlwZSA9IHByb3RvdHlwZUNoYWluLl9fcHJvdG9fX1xyXG4gICAgd2hpbGUgKG5leHRQcm90b3R5cGUgJiYgYmVmb3JlUHJvdG90eXBlICE9PSBuZXh0UHJvdG90eXBlLmRlbGVnYXRlZFByb3RvdHlwZSkge1xyXG4gICAgICBwcmV2aW91c1Byb3RvdHlwZSA9IG5leHRQcm90b3R5cGVcclxuICAgICAgbmV4dFByb3RvdHlwZSA9IG5leHRQcm90b3R5cGUuX19wcm90b19fXHJcbiAgICB9XHJcbiAgICBpZiAoIW5leHRQcm90b3R5cGUpIHRocm93IG5ldyBFcnJvcign4oCiIENvdWxkbmB0IGFkZCBvYmplY3QgdG8gcHJvdG90eXBlIGNoYWluLiBObyBtYXRjaGluZyBcImJlZm9yZVByb3RvdHlwZVwiIHdhcyBmb3VuZC4nKSAvLyBpZiBubyBhcHByb3ByaWF0ZSBpbnNlcnRpb24gcG9zaXRpb24gd2FzIGZvdW5kLlxyXG4gICAgLy8gY3JlYXRlIHBvaW50ZXJQcm90b3R5cGUgdG8gYWRkIGJldHdlZW4gdGhlIHByZXZpb3VzIGFuZCBuZXh0IHByb3RvdHlwZXMuXHJcbiAgICBsZXQgcG9pbnRlclByb3RvdHlwZSA9IE9iamVjdC5jcmVhdGUobmV4dFByb3RvdHlwZSlcclxuICAgIGlmICghcG9pbnRlclByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eSgnZGVsZWdhdGVkUHJvdG90eXBlJykpIHtcclxuICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KHBvaW50ZXJQcm90b3R5cGUsICdkZWxlZ2F0ZWRQcm90b3R5cGUnLCB7IHZhbHVlOiBvYmplY3RUb0FkZCwgd3JpdGFibGU6IHRydWUsIGVudW1lcmFibGU6IHRydWUsIGNvbmZpZ3VyYWJsZTogdHJ1ZSB9KVxyXG4gICAgfVxyXG4gICAgcG9pbnRlclByb3RvdHlwZSA9IG5ldyBQcm94eShcclxuICAgICAgcG9pbnRlclByb3RvdHlwZSxcclxuICAgICAgc2VsZi5oYW5kbGVyTXVsdGlwbGVQcm90b3R5cGVDaGFpblBhdHRlcm4oe1xyXG4gICAgICAgIGRlbGVnYXRlZFByb3RvdHlwZTogb2JqZWN0VG9BZGQsXHJcbiAgICAgIH0pLFxyXG4gICAgKVxyXG4gICAgT2JqZWN0LnNldFByb3RvdHlwZU9mKHByZXZpb3VzUHJvdG90eXBlLCBwb2ludGVyUHJvdG90eXBlKVxyXG4gICAgY29uc29sZS5sb2cocHJvdG90eXBlQ2hhaW4pXHJcbiAgICByZXR1cm4gcHJvdG90eXBlQ2hhaW5cclxuICB9XHJcbn1cclxuXHJcbmV4cG9ydCB7IHNlbGYgYXMgTXVsdGlwbGVQcm90b3R5cGVDaGFpbiB9XHJcbiJdfQ==