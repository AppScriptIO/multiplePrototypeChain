"use strict";Object.defineProperty(exports, "__esModule", { value: true });exports.inheritsMultipleConstructors = inheritsMultipleConstructors;exports.inheritsMultiple = inheritsMultiple;exports.MultipleDelegation = void 0;
const $ = {

  list: Symbol('MultipleDelegation: list'),
  getter: Symbol('MultipleDelegation: getter'),
  setter: Symbol('MultipleDelegation: setter'),

  metadata: Symbol('metadata'),

  target: Symbol.for('MultipleDelegation: non proxied target') };var _Symbol$hasInstance =











































































Symbol.hasInstance;class MultipleDelegation {static [_Symbol$hasInstance](instance) {
    return Boolean(instance[$.target]);
  }

  constructor() {

    let target = this;
    let proxiedPrototype = new Proxy(target, MultipleDelegation.proxyHandler);

    target[$.metadata] = {
      type: 'Multiple delegation proxy',
      get delegationList() {
        return target[$.getter]();
      } };

    target[$.list] = [];
    target[$.target] = target;
    return { proxiedPrototype, target };
  }


  static addDelegation({ targetObject, delegationList = [] }) {var _targetObject;
    if (delegationList.length == 0) return;
    let currentPrototype = (_targetObject = targetObject, Object.getPrototypeOf(_targetObject)),
    proxiedPrototype;
    if (!(currentPrototype instanceof MultipleDelegation)) {
      let proxied = new MultipleDelegation();
      proxiedPrototype = proxied.proxiedPrototype;
      if (currentPrototype) proxied.target[$.setter](currentPrototype);

      Object.setPrototypeOf(targetObject, proxiedPrototype);
    } else {
      proxiedPrototype = currentPrototype;
    }

    proxiedPrototype[$.target][$.setter](delegationList);
  }}exports.MultipleDelegation = MultipleDelegation;MultipleDelegation.Reference = $;MultipleDelegation.proxyHandler = { get(target, key, receiver) {if (key in target) return target[key];let delegationList = target[$.getter]();const parent = delegationList.find(p => Reflect.has(p, key));return parent ? Reflect.get(parent, key, receiver) : void 0;}, has: (target, key) => {let delegationList = target[$.getter]();return delegationList.some(p => Reflect.has(p, key));}, set(target, prop, value, receiver) {let delegationList = target[$.getter]();var obj = delegationList.find(obj => prop in obj);return Reflect.set(obj || Object.create(null), prop, value, receiver);}, *enumerate(target) {yield* this.ownKeys(target);}, ownKeys(target) {let delegationList = target[$.getter]();var hash = Object.create(null);for (var obj of delegationList) for (var p in obj) if (!hash[p]) hash[p] = true;return Object.getOwnPropertyNames(hash);}, getOwnPropertyDescriptor(target, prop) {let delegationList = target[$.getter]();function getDesc(obj, prop) {var desc = Object.getOwnPropertyDescriptor(obj, prop);return desc || (obj = Object.getPrototypeOf(obj) ? getDesc(obj, prop) : void 0);}var obj = delegationList.find(obj => prop in obj);var desc = obj ? getDesc(obj, prop) : void 0;if (desc) desc.configurable = true;return desc;}, preventExtensions: target => false, defineProperty: (target, prop, desc) => false, getPrototypeOf: target => {return target[$.list];}, setPrototypeOf: (target, prototype) => {target[$.setter](prototype);return true;} };


Object.assign(MultipleDelegation.prototype, {
  [$.setter](prototype) {
    if (!Array.isArray(prototype)) prototype = [prototype];
    this[$.list] = [...this[$.list], ...prototype];
  },
  [$.getter]() {
    return this[$.list];
  } });



function inheritsMultipleConstructors({ BaseCtor, SuperCtors }) {
  return new Proxy(BaseCtor, {
    construct(_, [baseArgs = [], superArgs = []], newTarget) {
      let instance = {};

      instance = SuperCtors.reduce((acc, Ctor, i) => {
        const args = superArgs[i] || [];
        return Object.assign(acc, new Ctor(...args));
      }, instance);

      instance = Object.assign(instance, new BaseCtor(...baseArgs));

      Object.setPrototypeOf(instance, BaseCtor.prototype);
      return instance;
    } });

}


function inheritsMultiple({ BaseCtor, SuperCtors }) {
  delegateToMultipleObject({
    targetObject: BaseCtor.prototype,
    delegationList: SuperCtors.map(Ctor => Ctor.prototype) });


  return inheritsMultipleConstructors({ BaseCtor, SuperCtors });
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NvdXJjZS9wcm94eVRyYXBBcHByb2FjaC9wcm94eVRyYXBBcHJvYWNoLmpzIl0sIm5hbWVzIjpbIiQiLCJsaXN0IiwiU3ltYm9sIiwiZ2V0dGVyIiwic2V0dGVyIiwibWV0YWRhdGEiLCJ0YXJnZXQiLCJmb3IiLCJoYXNJbnN0YW5jZSIsIk11bHRpcGxlRGVsZWdhdGlvbiIsImluc3RhbmNlIiwiQm9vbGVhbiIsImNvbnN0cnVjdG9yIiwicHJveGllZFByb3RvdHlwZSIsIlByb3h5IiwicHJveHlIYW5kbGVyIiwidHlwZSIsImRlbGVnYXRpb25MaXN0IiwiYWRkRGVsZWdhdGlvbiIsInRhcmdldE9iamVjdCIsImxlbmd0aCIsImN1cnJlbnRQcm90b3R5cGUiLCJPYmplY3QiLCJnZXRQcm90b3R5cGVPZiIsInByb3hpZWQiLCJzZXRQcm90b3R5cGVPZiIsIlJlZmVyZW5jZSIsImdldCIsImtleSIsInJlY2VpdmVyIiwicGFyZW50IiwiZmluZCIsInAiLCJSZWZsZWN0IiwiaGFzIiwic29tZSIsInNldCIsInByb3AiLCJ2YWx1ZSIsIm9iaiIsImNyZWF0ZSIsImVudW1lcmF0ZSIsIm93bktleXMiLCJoYXNoIiwiZ2V0T3duUHJvcGVydHlOYW1lcyIsImdldE93blByb3BlcnR5RGVzY3JpcHRvciIsImdldERlc2MiLCJkZXNjIiwiY29uZmlndXJhYmxlIiwicHJldmVudEV4dGVuc2lvbnMiLCJkZWZpbmVQcm9wZXJ0eSIsInByb3RvdHlwZSIsImFzc2lnbiIsIkFycmF5IiwiaXNBcnJheSIsImluaGVyaXRzTXVsdGlwbGVDb25zdHJ1Y3RvcnMiLCJCYXNlQ3RvciIsIlN1cGVyQ3RvcnMiLCJjb25zdHJ1Y3QiLCJfIiwiYmFzZUFyZ3MiLCJzdXBlckFyZ3MiLCJuZXdUYXJnZXQiLCJyZWR1Y2UiLCJhY2MiLCJDdG9yIiwiaSIsImFyZ3MiLCJpbmhlcml0c011bHRpcGxlIiwiZGVsZWdhdGVUb011bHRpcGxlT2JqZWN0IiwibWFwIl0sIm1hcHBp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QUlwRCxRQUFRLEdBQUcsRUFBZjs7QUFFQUEsTUFBQUEsUUFBUSxHQUFHK0MsVUFBVSxDQUFDTSxNQUFYLENBQWtCLENBQUNDLEdBQUQsRUFBTUMsSUFBTixFQUFZQyxDQUFaLEtBQWtCO0FBQzdDLGNBQU1DLElBQUksR0FBR04sU0FBUyxDQUFDSyxDQUFELENBQVQsSUFBZ0IsRUFBN0I7QUFDQSxlQUFPNUMsTUFBTSxDQUFDOEIsTUFBUCxDQUFjWSxHQUFkLEVBQW1CLElBQUlDLElBQUosQ0FBUyxHQUFHRSxJQUFaLENBQW5CLENBQVA7QUFDRCxPQUhVLEVBR1J6RCxRQUhRLENBQVg7O0FBS0FBLE1BQUFBLFFBQVEsR0FBR1ksTUFBTSxDQUFDOEIsTUFBUCxDQUFjMUMsUUFBZCxFQUF3QixJQUFJOEMsUUFBSixDQUFhLEdBQUdJLFFBQWhCLENBQXhCLENBQVg7O0FBRUF0QyxNQUFBQSxNQUFNLENBQUNHLGNBQVAsQ0FBc0JmLFFBQXRCLEVBQWdDOEMsUUFBUSxDQUFDTCxTQUF6QztBQUNBLGFBQU96QyxRQUFQO0FBQ0QsS0Fid0IsRUFBcEIsQ0FBUDs7QUFlRDs7O0FBR00sU0FBUzBELGdCQUFULENBQTBCLEVBQUVaLFFBQUYsRUFBWUMsVUFBWixFQUExQixFQUFvRDtBQUN6RFksRUFBQUEsd0JBQXdCLENBQUM7QUFDdkJsRCxJQUFBQSxZQUFZLEVBQUVxQyxRQUFRLENBQUNMLFNBREE7QUFFdkJsQyxJQUFBQSxjQUFjLEVBQUV3QyxVQUFVLENBQUNhLEdBQVgsQ0FBZUwsSUFBSSxJQUFJQSxJQUFJLENBQUNkLFNBQTVCLENBRk8sRUFBRCxDQUF4Qjs7O0FBS0EsU0FBT0ksNEJBQTRCLENBQUMsRUFBRUMsUUFBRixFQUFZQyxVQUFaLEVBQUQsQ0FBbkM7QUFDRCIsInNvdXJjZXNDb250ZW50IjpbIi8vIHRoZSAnUmVmZXJlbmNlJyBvZiBmdW5jdGlvbmFsaXR5IHN5bW5vbCBrZXlzXG5jb25zdCAkID0ge1xuICAvLyBkZWxlZ2F0aW9uIGxpc3Qgb2YgcHJvdG90eXBlc1xuICBsaXN0OiBTeW1ib2woJ011bHRpcGxlRGVsZWdhdGlvbjogbGlzdCcpLFxuICBnZXR0ZXI6IFN5bWJvbCgnTXVsdGlwbGVEZWxlZ2F0aW9uOiBnZXR0ZXInKSxcbiAgc2V0dGVyOiBTeW1ib2woJ011bHRpcGxlRGVsZWdhdGlvbjogc2V0dGVyJyksXG4gIC8vIGRlYnVnZ2luZyBwdXJwb3Nlc1xuICBtZXRhZGF0YTogU3ltYm9sKCdtZXRhZGF0YScpLFxuICAvLyB0aGlzIHN5bWJvbCBtdXN0IGJlIGdsb2JhbCB0byBhbGxvdyBtdWx0aXBsZSB2ZXJzaW9ucyBvZiB0aGUgc2FtZSBtb2R1bGUgdG8gd29yayB0b2dldGhlci5cbiAgdGFyZ2V0OiBTeW1ib2wuZm9yKCdNdWx0aXBsZURlbGVnYXRpb246IG5vbiBwcm94aWVkIHRhcmdldCcpLCAvLyB0aGUgb3JpZ2luYWwgdGFyZ2V0IHdoaWNoIHNob3VsZCBiZSB3cmFwcGVkIHdpdGggcHJveHkuXG59XG5leHBvcnQgY2xhc3MgTXVsdGlwbGVEZWxlZ2F0aW9uIHtcbiAgLy8gU3ltYm9sIGtleXMgb2YgbXVsdGlwbGUgZGVsZWdhdGlvbiBwcm94eSBmdW5jdGlvbmFsaXR5LlxuICBzdGF0aWMgUmVmZXJlbmNlID0gJFxuXG4gIC8qICAgICBcbiAgVGhlcmUgYXJlIG1vcmUgdHJhcHMgYXZhaWxhYmxlLCB3aGljaCBhcmUgbm90IHVzZWRcbiAgVGhlIGRlbGV0ZVByb3BlcnR5IHRyYXAgaXMgYSB0cmFwIGZvciBkZWxldGluZyBvd24gcHJvcGVydGllcy4gVGhlIHByb3h5IHJlcHJlc2VudHMgdGhlIGluaGVyaXRhbmNlLCBzbyB0aGlzIHdvdWxkbid0IG1ha2UgbXVjaCBzZW5zZS4gSSBsZXQgaXQgYXR0ZW1wdCB0aGUgZGVsZXRpb24gb24gdGhlIHRhcmdldCwgd2hpY2ggc2hvdWxkIGhhdmUgbm8gcHJvcGVydHkgYW55d2F5LlxuICBUaGUgaXNFeHRlbnNpYmxlIHRyYXAgaXMgYSB0cmFwIGZvciBnZXR0aW5nIHRoZSBleHRlbnNpYmlsaXR5LiBOb3QgbXVjaCB1c2VmdWwsIGdpdmVuIHRoYXQgYW4gaW52YXJpYW50IGZvcmNlcyBpdCB0byByZXR1cm4gdGhlIHNhbWUgZXh0ZW5zaWJpbGl0eSBhcyB0aGUgdGFyZ2V0LiBTbyBJIGp1c3QgbGV0IGl0IHJlZGlyZWN0IHRoZSBvcGVyYXRpb24gdG8gdGhlIHRhcmdldCwgd2hpY2ggd2lsbCBiZSBleHRlbnNpYmxlLlxuICBUaGUgYXBwbHkgYW5kIGNvbnN0cnVjdCB0cmFwcyBhcmUgdHJhcHMgZm9yIGNhbGxpbmcgb3IgaW5zdGFudGlhdGluZy4gVGhleSBhcmUgb25seSB1c2VmdWwgd2hlbiB0aGUgdGFyZ2V0IGlzIGEgZnVuY3Rpb24gb3IgYSBjb25zdHJ1Y3Rvci5cbiAgKi9cbiAgc3RhdGljIHByb3h5SGFuZGxlciA9IHtcbiAgICAvLyBUaGUgZ2V0IHRyYXAgaXMgYSB0cmFwIGZvciBnZXR0aW5nIHByb3BlcnR5IHZhbHVlcy4gSSB1c2UgZmluZCB0byBmaW5kIHRoZSBmaXJzdCBwcm90b3R5cGUgd2hpY2ggY29udGFpbnMgdGhhdCBwcm9wZXJ0eSwgYW5kIEkgcmV0dXJuIHRoZSB2YWx1ZSwgb3IgY2FsbCB0aGUgZ2V0dGVyIG9uIHRoZSBhcHByb3ByaWF0ZSByZWNlaXZlci4gVGhpcyBpcyBoYW5kbGVkIGJ5IFJlZmxlY3QuZ2V0LiBJZiBubyBwcm90b3R5cGUgY29udGFpbnMgdGhlIHByb3BlcnR5LCBJIHJldHVybiB1bmRlZmluZWQuXG4gICAgZ2V0KHRhcmdldCwga2V5LCByZWNlaXZlcikge1xuICAgICAgLy8gYWxsb3cgYWNjZXNzIHRvIHRhcmdldCdzIE11bHRpcGxlRGVsZWdhdGlvbiBGdW5jdGlvbmFsaXRpZXMgdG8gZ2V0IHRoZSBsaXN0IG9mIGRlbGdhdGlvbnMuXG4gICAgICBpZiAoa2V5IGluIHRhcmdldCkgcmV0dXJuIHRhcmdldFtrZXldXG5cbiAgICAgIGxldCBkZWxlZ2F0aW9uTGlzdCA9IHRhcmdldFskLmdldHRlcl0oKVxuICAgICAgY29uc3QgcGFyZW50ID0gZGVsZWdhdGlvbkxpc3QuZmluZChwID0+IFJlZmxlY3QuaGFzKHAsIGtleSkpXG4gICAgICByZXR1cm4gcGFyZW50ID8gUmVmbGVjdC5nZXQocGFyZW50LCBrZXksIHJlY2VpdmVyKSA6IHZvaWQgMCAvLyBiZWNhdXNlIGB1bmRlZmluZWRgIGlzIGEgZ2xvYmFsIHZhcmlhYmxlIGFuZCBub3QgYSByZXNlcnZlZCB3b3JkIGluIEpTLiB2b2lkIHNpbXBseSBpbnN1cmVzIHRoZSByZXR1cm4gb2YgdW5kZWZpbmVkLlxuICAgIH0sXG4gICAgLy8gVGhlIGhhcyB0cmFwIGlzIGEgdHJhcCBmb3IgdGhlIGluIG9wZXJhdG9yLiBJIHVzZSBzb21lIHRvIGNoZWNrIGlmIGF0IGxlYXN0IG9uZSBwcm90b3R5cGUgY29udGFpbnMgdGhlIHByb3BlcnR5LlxuICAgIGhhczogKHRhcmdldCwga2V5KSA9PiB7XG4gICAgICBsZXQgZGVsZWdhdGlvbkxpc3QgPSB0YXJnZXRbJC5nZXR0ZXJdKClcbiAgICAgIHJldHVybiBkZWxlZ2F0aW9uTGlzdC5zb21lKHAgPT4gUmVmbGVjdC5oYXMocCwga2V5KSlcbiAgICB9LFxuICAgIC8vIFRoZSBzZXQgdHJhcCBpcyBhIHRyYXAgZm9yIHNldHRpbmcgcHJvcGVydHkgdmFsdWVzLiBJIHVzZSBmaW5kIHRvIGZpbmQgdGhlIGZpcnN0IHByb3RvdHlwZSB3aGljaCBjb250YWlucyB0aGF0IHByb3BlcnR5LCBhbmQgSSBjYWxsIGl0cyBzZXR0ZXIgb24gdGhlIGFwcHJvcHJpYXRlIHJlY2VpdmVyLiBJZiB0aGVyZSBpcyBubyBzZXR0ZXIgb3Igbm8gcHJvdG90eXBlIGNvbnRhaW5zIHRoZSBwcm9wZXJ0eSwgdGhlIHZhbHVlIGlzIGRlZmluZWQgb24gdGhlIGFwcHJvcHJpYXRlIHJlY2VpdmVyLiBUaGlzIGlzIGhhbmRsZWQgYnkgUmVmbGVjdC5zZXQuXG4gICAgc2V0KHRhcmdldCwgcHJvcCwgdmFsdWUsIHJlY2VpdmVyKSB7XG4gICAgICBsZXQgZGVsZWdhdGlvbkxpc3QgPSB0YXJnZXRbJC5nZXR0ZXJdKClcbiAgICAgIHZhciBvYmogPSBkZWxlZ2F0aW9uTGlzdC5maW5kKG9iaiA9PiBwcm9wIGluIG9iailcbiAgICAgIHJldHVybiBSZWZsZWN0LnNldChvYmogfHwgT2JqZWN0LmNyZWF0ZShudWxsKSwgcHJvcCwgdmFsdWUsIHJlY2VpdmVyKVxuICAgIH0sXG4gICAgLyoqXG4gICAgICogVGhlIGVudW1lcmF0ZSB0cmFwIGlzIGEgdHJhcCBmb3IgZm9yLi4uaW4gbG9vcHMuIEkgaXRlcmF0ZSB0aGUgZW51bWVyYWJsZSBwcm9wZXJ0aWVzIGZyb20gdGhlIGZpcnN0IHByb3RvdHlwZSwgdGhlbiBmcm9tIHRoZSBzZWNvbmQsIGFuZCBzbyBvbi4gT25jZSBhIHByb3BlcnR5IGhhcyBiZWVuIGl0ZXJhdGVkLCBJIHN0b3JlIGl0IGluIGEgaGFzaCB0YWJsZSB0byBhdm9pZCBpdGVyYXRpbmcgaXQgYWdhaW4uXG4gICAgICogV2FybmluZzogVGhpcyB0cmFwIGhhcyBiZWVuIHJlbW92ZWQgaW4gRVM3IGRyYWZ0IGFuZCBpcyBkZXByZWNhdGVkIGluIGJyb3dzZXJzLlxuICAgICAqL1xuICAgICplbnVtZXJhdGUodGFyZ2V0KSB7XG4gICAgICB5aWVsZCogdGhpcy5vd25LZXlzKHRhcmdldClcbiAgICB9LFxuICAgIC8vIFRoZSBvd25LZXlzIHRyYXAgaXMgYSB0cmFwIGZvciBPYmplY3QuZ2V0T3duUHJvcGVydHlOYW1lcygpLiBTaW5jZSBFUzcsIGZvci4uLmluIGxvb3BzIGtlZXAgY2FsbGluZyBbW0dldFByb3RvdHlwZU9mXV0gYW5kIGdldHRpbmcgdGhlIG93biBwcm9wZXJ0aWVzIG9mIGVhY2ggb25lLiBTbyBpbiBvcmRlciB0byBtYWtlIGl0IGl0ZXJhdGUgdGhlIHByb3BlcnRpZXMgb2YgYWxsIHByb3RvdHlwZXMsIEkgdXNlIHRoaXMgdHJhcCB0byBtYWtlIGFsbCBlbnVtZXJhYmxlIGluaGVyaXRlZCBwcm9wZXJ0aWVzIGFwcGVhciBsaWtlIG93biBwcm9wZXJ0aWVzLlxuICAgIG93bktleXModGFyZ2V0KSB7XG4gICAgICBsZXQgZGVsZWdhdGlvbkxpc3QgPSB0YXJnZXRbJC5nZXR0ZXJdKClcbiAgICAgIHZhciBoYXNoID0gT2JqZWN0LmNyZWF0ZShudWxsKVxuICAgICAgZm9yICh2YXIgb2JqIG9mIGRlbGVnYXRpb25MaXN0KSBmb3IgKHZhciBwIGluIG9iaikgaWYgKCFoYXNoW3BdKSBoYXNoW3BdID0gdHJ1ZVxuICAgICAgcmV0dXJuIE9iamVjdC5nZXRPd25Qcm9wZXJ0eU5hbWVzKGhhc2gpXG4gICAgfSxcbiAgICAvLyBUaGUgZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yIHRyYXAgaXMgYSB0cmFwIGZvciBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKCkuIE1ha2luZyBhbGwgZW51bWVyYWJsZSBwcm9wZXJ0aWVzIGFwcGVhciBsaWtlIG93biBwcm9wZXJ0aWVzIGluIHRoZSBvd25LZXlzIHRyYXAgaXMgbm90IGVub3VnaCwgZm9yLi4uaW4gbG9vcHMgd2lsbCBnZXQgdGhlIGRlc2NyaXB0b3IgdG8gY2hlY2sgaWYgdGhleSBhcmUgZW51bWVyYWJsZS4gU28gSSB1c2UgZmluZCB0byBmaW5kIHRoZSBmaXJzdCBwcm90b3R5cGUgd2hpY2ggY29udGFpbnMgdGhhdCBwcm9wZXJ0eSwgYW5kIEkgaXRlcmF0ZSBpdHMgcHJvdG90eXBpY2FsIGNoYWluIHVudGlsIEkgZmluZCB0aGUgcHJvcGVydHkgb3duZXIsIGFuZCBJIHJldHVybiBpdHMgZGVzY3JpcHRvci4gSWYgbm8gcHJvdG90eXBlIGNvbnRhaW5zIHRoZSBwcm9wZXJ0eSwgSSByZXR1cm4gdW5kZWZpbmVkLiBUaGUgZGVzY3JpcHRvciBpcyBtb2RpZmllZCB0byBtYWtlIGl0IGNvbmZpZ3VyYWJsZSwgb3RoZXJ3aXNlIHdlIGNvdWxkIGJyZWFrIHNvbWUgcHJveHkgaW52YXJpYW50cy5cbiAgICBnZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IodGFyZ2V0LCBwcm9wKSB7XG4gICAgICBsZXQgZGVsZWdhdGlvbkxpc3QgPSB0YXJnZXRbJC5nZXR0ZXJdKClcbiAgICAgIGZ1bmN0aW9uIGdldERlc2Mob2JqLCBwcm9wKSB7XG4gICAgICAgIHZhciBkZXNjID0gT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcihvYmosIHByb3ApXG4gICAgICAgIHJldHVybiBkZXNjIHx8IChvYmogPSBPYmplY3QuZ2V0UHJvdG90eXBlT2Yob2JqKSA/IGdldERlc2Mob2JqLCBwcm9wKSA6IHZvaWQgMClcbiAgICAgIH1cbiAgICAgIHZhciBvYmogPSBkZWxlZ2F0aW9uTGlzdC5maW5kKG9iaiA9PiBwcm9wIGluIG9iailcbiAgICAgIHZhciBkZXNjID0gb2JqID8gZ2V0RGVzYyhvYmosIHByb3ApIDogdm9pZCAwXG4gICAgICBpZiAoZGVzYykgZGVzYy5jb25maWd1cmFibGUgPSB0cnVlXG4gICAgICByZXR1cm4gZGVzY1xuICAgIH0sXG4gICAgLy8gVGhlIHByZXZlbnRFeHRlbnNpb25zIGFuZCBkZWZpbmVQcm9wZXJ0eSB0cmFwcyBhcmUgb25seSBpbmNsdWRlZCB0byBwcmV2ZW50IHRoZXNlIG9wZXJhdGlvbnMgZnJvbSBtb2RpZnlpbmcgdGhlIHByb3h5IHRhcmdldC4gT3RoZXJ3aXNlIHdlIGNvdWxkIGVuZCB1cCBicmVha2luZyBzb21lIHByb3h5IGludmFyaWFudHMuXG4gICAgcHJldmVudEV4dGVuc2lvbnM6IHRhcmdldCA9PiBmYWxzZSxcbiAgICBkZWZpbmVQcm9wZXJ0eTogKHRhcmdldCwgcHJvcCwgZGVzYykgPT4gZmFsc2UsXG4gICAgLyoqIFRoZSBnZXRQcm90b3R5cGVPZiB0cmFwIGNvdWxkIGJlIGFkZGVkLCBidXQgdGhlcmUgaXMgbm8gcHJvcGVyIHdheSB0byByZXR1cm4gdGhlIG11bHRpcGxlIHByb3RvdHlwZXMuIFRoaXMgaW1wbGllcyBpbnN0YW5jZW9mIHdvbid0IHdvcmsgbmVpdGhlci4gVGhlcmVmb3JlLFxuICAgICAqIE9yaWdpYW5sbHkgYmVmb3IgZXRoaXMgaW1wbGVtZW50YXRpb24sIEkgbGV0IGl0IGdldCB0aGUgcHJvdG90eXBlIG9mIHRoZSB0YXJnZXQsIHdoaWNoIGluaXRpYWxseSBpcyBudWxsLlxuICAgICAqL1xuICAgIGdldFByb3RvdHlwZU9mOiB0YXJnZXQgPT4ge1xuICAgICAgcmV0dXJuIHRhcmdldFskLmxpc3RdIC8vIHJldHVybiBhcnJheSBvZiBkZWxlZ2F0ZWQgcHJvdG90eXBlc1xuICAgIH0sXG4gICAgLy8gVGhlIHNldFByb3RvdHlwZU9mIHRyYXAgY291bGQgYmUgYWRkZWQgYW5kIGFjY2VwdCBhbiBhcnJheSBvZiBvYmplY3RzLCB3aGljaCB3b3VsZCByZXBsYWNlIHRoZSBwcm90b3R5cGVzLiBUaGlzIGlzIGxlZnQgYXMgYW4gZXhlcmNpY2UgZm9yIHRoZSByZWFkZXIuIEhlcmUgSSBqdXN0IGxldCBpdCBtb2RpZnkgdGhlIHByb3RvdHlwZSBvZiB0aGUgdGFyZ2V0LCB3aGljaCBpcyBub3QgbXVjaCB1c2VmdWwgYmVjYXVzZSBubyB0cmFwIHVzZXMgdGhlIHRhcmdldC5cbiAgICBzZXRQcm90b3R5cGVPZjogKHRhcmdldCwgcHJvdG90eXBlKSA9PiB7XG4gICAgICB0YXJnZXRbJC5zZXR0ZXJdKHByb3RvdHlwZSkgLy8gYWRkIHByb3RvdHlwZSB0byBkZWxlZ2F0ZWQgbGlzdCBvZiBwcm90b3R5cGVzXG4gICAgICByZXR1cm4gdHJ1ZVxuICAgIH0sXG4gIH1cblxuICAvLyBUcmFwIGBpbnN0YW5jZW9mYCAtIGNoZWNrIGlmIGluc3RhbmNlIGlzIG9mIE11bHRpcGxlRGVsZWdhdGlvblxuICBzdGF0aWMgW1N5bWJvbC5oYXNJbnN0YW5jZV0oaW5zdGFuY2UpIHtcbiAgICByZXR1cm4gQm9vbGVhbihpbnN0YW5jZVskLnRhcmdldF0pIC8vIGNoZWNrIGNvbnN0cnVjdG9yIG9uIHRoZSBub24gcHJveGllZCB0YXJnZXQuXG4gIH1cblxuICBjb25zdHJ1Y3RvcigpIHtcbiAgICAvLyBUaGUgdGFyZ2V0IGlzIG5vdCBtZWFudCB0byBiZSBhY2Nlc3NhYmxlIGV4dGVybmFsbHkgdGhyb3VnaCB0aGUgd3JhcHBlciBwcm94eS5cbiAgICBsZXQgdGFyZ2V0ID0gdGhpc1xuICAgIGxldCBwcm94aWVkUHJvdG90eXBlID0gbmV3IFByb3h5KHRhcmdldCwgTXVsdGlwbGVEZWxlZ2F0aW9uLnByb3h5SGFuZGxlcilcbiAgICAvLyBkZWJ1Z2dpbmcgLSB3aGVuIGNvbnNvbGUgbG9nZ2luZyBpdCB3aWxsIG1hcmsgb2JqZWN0IGFzIHByb3h5IGFuZCBpbiBpbnNwZWN0b3IgZGVidWdnaW5nIHRvby5cbiAgICB0YXJnZXRbJC5tZXRhZGF0YV0gPSB7XG4gICAgICB0eXBlOiAnTXVsdGlwbGUgZGVsZWdhdGlvbiBwcm94eScsXG4gICAgICBnZXQgZGVsZWdhdGlvbkxpc3QoKSB7XG4gICAgICAgIHJldHVybiB0YXJnZXRbJC5nZXR0ZXJdKClcbiAgICAgIH0sXG4gICAgfVxuICAgIHRhcmdldFskLmxpc3RdID0gW10gLy8gaW5pdGlhbGl6ZSBtdWx0aXBsZSBkZWxlZ2FpdG9uIGxpc3QgcHJvcGVydHkuXG4gICAgdGFyZ2V0WyQudGFyZ2V0XSA9IHRhcmdldFxuICAgIHJldHVybiB7IHByb3hpZWRQcm90b3R5cGUsIHRhcmdldCB9XG4gIH1cblxuICAvKiogU3VwcG9ydCBtdWx0aXBsZSBkZWxlZ2F0ZWQgcHJvdG90eXBlIHByb3BlcnR5IGxvb2t1cCwgd2hlcmUgdGhlIHRhcmdldCdzIHByb3RvdHlwZSBpcyBvdmVyd3JpdHRlbiBieSBhIHByb3h5LiAqL1xuICBzdGF0aWMgYWRkRGVsZWdhdGlvbih7IHRhcmdldE9iamVjdCwgZGVsZWdhdGlvbkxpc3QgPSBbXSB9KSB7XG4gICAgaWYgKGRlbGVnYXRpb25MaXN0Lmxlbmd0aCA9PSAwKSByZXR1cm5cbiAgICBsZXQgY3VycmVudFByb3RvdHlwZSA9IHRhcmdldE9iamVjdCB8PiBPYmplY3QuZ2V0UHJvdG90eXBlT2YsXG4gICAgICBwcm94aWVkUHJvdG90eXBlXG4gICAgaWYgKCEoY3VycmVudFByb3RvdHlwZSBpbnN0YW5jZW9mIE11bHRpcGxlRGVsZWdhdGlvbikpIHtcbiAgICAgIGxldCBwcm94aWVkID0gbmV3IE11bHRpcGxlRGVsZWdhdGlvbigpXG4gICAgICBwcm94aWVkUHJvdG90eXBlID0gcHJveGllZC5wcm94aWVkUHJvdG90eXBlXG4gICAgICBpZiAoY3VycmVudFByb3RvdHlwZSkgcHJveGllZC50YXJnZXRbJC5zZXR0ZXJdKGN1cnJlbnRQcm90b3R5cGUpXG4gICAgICAvLyBEZWxlZ2F0ZSB0byBwcm94eSB0aGF0IHdpbGwgaGFuZGxlIGFuZCByZWRpcmVjdCBmdW5kYW1lbnRhbCBvcGVyYXRpb25zIHRvIHRoZSBhcHByb3ByaWF0ZSBvYmplY3QuXG4gICAgICBPYmplY3Quc2V0UHJvdG90eXBlT2YodGFyZ2V0T2JqZWN0LCBwcm94aWVkUHJvdG90eXBlKVxuICAgIH0gZWxzZSB7XG4gICAgICBwcm94aWVkUHJvdG90eXBlID0gY3VycmVudFByb3RvdHlwZVxuICAgIH1cbiAgICAvLyBhZGQgZGVsZWdhdGlvbiBwcm90b3R5cGVzIHRvIG11bHRpcGxlIGRlbGVsZ2F0aW9uIHByb3h5LlxuICAgIHByb3hpZWRQcm90b3R5cGVbJC50YXJnZXRdWyQuc2V0dGVyXShkZWxlZ2F0aW9uTGlzdClcbiAgfVxufVxuXG5PYmplY3QuYXNzaWduKE11bHRpcGxlRGVsZWdhdGlvbi5wcm90b3R5cGUsIHtcbiAgWyQuc2V0dGVyXShwcm90b3R5cGUpIHtcbiAgICBpZiAoIUFycmF5LmlzQXJyYXkocHJvdG90eXBlKSkgcHJvdG90eXBlID0gW3Byb3RvdHlwZV1cbiAgICB0aGlzWyQubGlzdF0gPSBbLi4udGhpc1skLmxpc3RdLCAuLi5wcm90b3R5cGVdIC8vIE5vdGU6ICd0aGlzJyBzaG91bGQgYmUgdGhlIG9yaWdpbmFsIHRhcmdldCBub3QgdGhlIHByb3h5LlxuICB9LFxuICBbJC5nZXR0ZXJdKCkge1xuICAgIHJldHVybiB0aGlzWyQubGlzdF1cbiAgfSxcbn0pXG5cbi8vIGltcGxlbWVudCBtdWx0aXBsZSBzdXBlciBjb25zdHJ1Y3RvcnMgd2l0aCBhYmlsaXR5IHRvIHBhc3MgdW5pcXVlIGFyZ3VtZW50cyBmb3IgZWFjaCBkdXJpbmcgaW5zdGFuY2UgY3JlYXRpb24uXG5leHBvcnQgZnVuY3Rpb24gaW5oZXJpdHNNdWx0aXBsZUNvbnN0cnVjdG9ycyh7IEJhc2VDdG9yLCBTdXBlckN0b3JzIH0pIHtcbiAgcmV0dXJuIG5ldyBQcm94eShCYXNlQ3Rvciwge1xuICAgIGNvbnN0cnVjdChfLCBbYmFzZUFyZ3MgPSBbXSwgc3VwZXJBcmdzID0gW11dLCBuZXdUYXJnZXQpIHtcbiAgICAgIGxldCBpbnN0YW5jZSA9IHt9XG5cbiAgICAgIGluc3RhbmNlID0gU3VwZXJDdG9ycy5yZWR1Y2UoKGFjYywgQ3RvciwgaSkgPT4ge1xuICAgICAgICBjb25zdCBhcmdzID0gc3VwZXJBcmdzW2ldIHx8IFtdXG4gICAgICAgIHJldHVybiBPYmplY3QuYXNzaWduKGFjYywgbmV3IEN0b3IoLi4uYXJncykpXG4gICAgICB9LCBpbnN0YW5jZSlcblxuICAgICAgaW5zdGFuY2UgPSBPYmplY3QuYXNzaWduKGluc3RhbmNlLCBuZXcgQmFzZUN0b3IoLi4uYmFzZUFyZ3MpKVxuXG4gICAgICBPYmplY3Quc2V0UHJvdG90eXBlT2YoaW5zdGFuY2UsIEJhc2VDdG9yLnByb3RvdHlwZSlcbiAgICAgIHJldHVybiBpbnN0YW5jZVxuICAgIH0sXG4gIH0pXG59XG5cbi8vIGNyZWF0ZSBkZWxlZ2F0aW9uIG9uIGNvbnN0cnVjdG9ycyAmIHByb3RvdHlwZXMuXG5leHBvcnQgZnVuY3Rpb24gaW5oZXJpdHNNdWx0aXBsZSh7IEJhc2VDdG9yLCBTdXBlckN0b3JzIH0pIHtcbiAgZGVsZWdhdGVUb011bHRpcGxlT2JqZWN0KHtcbiAgICB0YXJnZXRPYmplY3Q6IEJhc2VDdG9yLnByb3RvdHlwZSxcbiAgICBkZWxlZ2F0aW9uTGlzdDogU3VwZXJDdG9ycy5tYXAoQ3RvciA9PiBDdG9yLnByb3RvdHlwZSksXG4gIH0pXG5cbiAgcmV0dXJuIGluaGVyaXRzTXVsdGlwbGVDb25zdHJ1Y3RvcnMoeyBCYXNlQ3RvciwgU3VwZXJDdG9ycyB9KVxufVxuIl19